<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Production & QC Entry</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px}
    .panel{border:1px solid #ddd;padding:12px;margin-bottom:12px;border-radius:6px}
    label{display:block;margin:6px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row > label{flex:1 1 200px}
    .status{margin-top:8px;font-size:13px}
  </style>
</head>
<body>
  <h2>Production Entry</h2>
  <div class="panel">
    <form id="prodForm">
      <div class="row">
        <label>Product ID: <input name="product_id" required></label>
        <label>Machine ID: <input name="machine_id" required></label>
        <label>Operator ID: <input name="operator_id" required></label>
        <label>Shift (date & time): <input name="shift" type="datetime-local" required></label>
      </div>
      <div style="margin-top:8px">
        <button type="submit">Submit Production</button>
        <button type="reset">Reset</button>
      </div>
      <div id="prodStatus" class="status" aria-live="polite"></div>
    </form>
  </div>

  <h2>QC Inspection Entry</h2>
  <div class="panel">
    <form id="qcForm">
      <div class="row">
        <label>Product ID: <input name="product_id" required></label>
        <label>Work Order ID: <input name="work_order_id" required></label>
        <label>Check Type: <input name="check_type" required placeholder="visual/dimensions/etc"></label>
        <label>Inspector ID: <input name="inspector_id" required></label>
      </div>
      <div style="margin-top:6px">
        <label>Result:
          <label><input type="radio" name="result" value="pass" required> Pass</label>
          <label><input type="radio" name="result" value="fail"> Fail</label>
        </label>
      </div>
      <div style="margin-top:8px">
        <button type="submit">Submit QC</button>
        <button type="reset">Reset</button>
      </div>
      <div id="qcStatus" class="status" aria-live="polite"></div>
    </form>
  </div>

  <script>
    async function submitForm(formEl, endpoint, fallbackKey, statusEl) {
      statusEl.textContent = '';
      const data = Object.fromEntries(new FormData(formEl));
      // Basic required check
      for (const [k,v] of Object.entries(data)) {
        if (!v) { statusEl.textContent = 'Please fill all fields.'; statusEl.style.color='crimson'; return; }
      }
      data.submittedAt = new Date().toISOString();
      try {
        const res = await fetch(endpoint, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        if (!res.ok) throw new Error('status ' + res.status);
        statusEl.textContent = 'Saved.';
        statusEl.style.color = 'green';
        formEl.reset();
      } catch (err) {
        const q = JSON.parse(localStorage.getItem(fallbackKey) || '[]');
        q.push(data);
        localStorage.setItem(fallbackKey, JSON.stringify(q));
        statusEl.textContent = 'Offline: saved locally.';
        statusEl.style.color = 'orange';
      }
    }

    document.getElementById('prodForm').addEventListener('submit', function(e){
      e.preventDefault();
      submitForm(this, '/api/production', 'prod_pending', document.getElementById('prodStatus'));
    });

    document.getElementById('qcForm').addEventListener('submit', function(e){
      e.preventDefault();
      submitForm(this, '/api/qc', 'qc_pending', document.getElementById('qcStatus'));
    });
  </script>
</body>
</html>